#!/usr/bin/env node

var fs = require('fs');
var aseUtil = require('../lib');
var read = aseUtil.read;
var formatAsLess = aseUtil.formatAsLess;
var formatAsColorsObject = aseUtil.formatAsColorsObject;

var argv = require('yargs')
  .usage('Dumps the colors and groups of an .ase file as JSON.\n\nUsage: $0 [options] filename.ase')
  .demand(1)
  .options({
    pretty: {
      default: false,
      describe: 'Pretty print the output',
      type: 'boolean'
    },
    f: {
      alias: 'format',
      default: 'json',
      describe: 'Output format: json, json-colors, less',
      type: 'string'
    }
  })
  .check(function (argv) {
    var fmt = argv.format.toLowerCase();
    if (fmt !== 'json' && fmt !== 'less' && fmt != 'json-colors') {
      throw new Error('Unsupported output format "' + fmt + '". Supported output formats: json, json-colors, less');
    }
    return true;
  })
  .argv;

var result = read(fs.readFileSync(argv._[0]));
var fmt = argv.format.toLowerCase();
if (fmt === 'json') {
  console.log(JSON.stringify(result, null, argv.pretty ? '  ' : null));
} else if (fmt === 'less') {
  console.log(formatAsLess(result));
} else if (fmt === 'json-colors') {
  console.log(JSON.stringify(formatAsColorsObject(result), null, argv.pretty ? '  ' : null));
}
